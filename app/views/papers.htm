<set user="{{ \models\User::instance() }}" />
<nav id="papers-navbar" class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand page-scroll" href="#page-top"><img src="/img/logo.svg" height="34" title="" alt="DjLu" /> - {{ @user->getUsername() }}'s library</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar">
            <ul class="nav navbar-nav navbar-right">
                <check if="{{ @user->getGit() }}">
                    <li><a href="#" id="pull-btn"><i class="fa fa-refresh"></i> Pull</a></li>
                    <li><a href="#" id="modal-push-btn"><i class="fa fa-cloud-upload"></i> Commit &amp; push</a></li>
                </check>
                <li><a href="#" data-toggle="modal" data-target="#modal-paper-add"><i class="fa fa-plus"></i> Add a paper</a></li>
                <li><a href="#" data-toggle="modal" data-target="#modal-settings"><i class="fa fa-cog"></i> Settings</a></li>
                <li><a href="{{ 'logout' | alias }}"><i class="fa fa-sign-out"></i> Logout</a></li>
            </ul>
        </div>
    </div>
</nav>

<div id="papers-container">
    <div id="papers-col-left">
        <div id="colorpicker" style="display: none;">
            <div class="popover colorpicker" role="tooltip">
                <div class="arrow"></div>
                <repeat group="{{ explode('-', @TAGS_PALETTE) }}" value="{{ @color }}"><span data-color="{{ @color }}" style="background: #{{ @color }}"></span></repeat>
            </div>
        </div>
        <div id="papers-col-left-container">
            <loop from="{{ @i=0 }}" to="{{ @i < count(\models\Papers::$TAGS_GROUPS) }}" step="{{ @i++ }}">
                <h3>{{ \models\Papers::$TAGS_GROUPS_LABELS[@i] }}</h3>
                <ul class="nav" data-tag-group="{{ \models\Papers::$TAGS_GROUPS[@i] }}">
                    <repeat group="{{ @tags[\models\Papers::$TAGS_GROUPS[@i]] }}" key="{{ @tag }}" value="{{ @color }}">
                        <li class="tag" data-tag="{{ @tag }}">
                            <a class="tag-colorpicker label label-default" tabindex="0" role="button" style="background: #{{ @color }}"><i class="fa fa-caret-down"></i></a>
                            <span class="tag-label label label-default" style="background: #{{ @color }}; color: #{{ \lib\Formatting::textColorFromBgColor(@color); }}"><span>{{ @tag }}</span></span>
                        </li>
                    </repeat>
                </ul>
                <p class="text-right"><a href="#" class="btn btn-default btn-xs tags-reset" data-tag-group="{{ \models\Papers::$TAGS_GROUPS[@i] }}">Reset filters</a></p>
            </loop>
        </div>
    </div>
    <div id="papers-col-middle">
        <table class="table table-striped table-hover" id="papers-table">
            <thead>
            <tr id="papers-table-header">
                <th>Title</th>
                <th>Author</th>
                <th class="text-right">Publication</th>
                <th class="text-right">Added</th>
                <th data-toggle="tooltip" data-placement="top" title="Rating"></th>
            </tr>
            </thead>
            <tbody>
            <repeat group="{{ @papers }}" value="{{ @paper }}">
            <tr class="paper" data-paper-key="{{ @paper.key }}" id="paper-row-{{ @paper.key }}">
                <include href="paper.htm" />
            </tr>
            </repeat>
            </tbody>
        </table>
    </div>
    <div id="papers-col-right">
        <div id="papers-col-right-close"><i class="fa fa-close"></i></div>
        <div id="paper-placeholder">
            No paper selected
        </div>
        <div id="paper-wait" style="display: none;">
            <i class="fa fa-refresh faa-spin animated"></i>
        </div>
        <div id="paper-details" data-key="" style="display: none;">
            <h4 class="editable compact"><span class="title" data-key="title" data-title="Title"></span></h4>
            <p class="editable authorsContainer"><span class="authors" data-key="authors" data-title="Authors (semicolon separated)"></span></p>
            <p><strong>Citation key: </strong><span class="citationKey"></span></p>
            <p class="editable"><strong>Pub. in: </strong><span class="in" data-key="in" data-title="Published in"></span></p>
            <p class="editable"><strong>Year: </strong><span class="year" data-key="year" data-title="Year"></span></p>
            <p class="compact"><strong>Tags:</strong></p>
            <p class="editable compact indent"><em><abbr title="Content tags">C</abbr>: </em><span class="tags_content" data-key="tags_content" data-title="Tags about the content of the paper (semicolon separated)"></span></p>
            <p class="editable compact indent"><em><abbr title="Reading status tags">R</abbr>: </em><span class="tags_reading" data-key="tags_reading" data-title="Tags about the reading status (semicolon separated)"></span></p>
            <p class="editable indent"><em><abbr title="Additional notes tags">N</abbr>: </em><span class="tags_notes" data-key="tags_notes" data-title="Tags to take super-short notes (semicolon separated)"></span></p>
            <p class="editable"><strong>Added on: </strong><span class="date_added" data-key="date_added" data-title="Added on (YYYY-MM-DD HH:MM format)"></span></p>
            <p class="editable"><strong>URL: </strong><span id="paper-url-actions">
                <a href="#" class="btn btn-default btn-xs" data-toggle="tooltip" data-placement="top" title="Discover Google Drive URL" id="js_drive_fetch"><i class="fa fa-refresh"></i></a>
                <a href="#" class="btn btn-default btn-xs" data-toggle="tooltip" data-placement="top" title="Save PDF to Google Drive from URL"id="js_drive_import"><i class="fa fa-cloud-upload"></i></a>
                <a href="#" class="btn btn-default btn-xs" id="js_drive_upload" data-toggle="tooltip" data-placement="top" title="Upload PDF to Google Drive"><i class="fa fa-upload"></i><input type="file"></a>
            </span> <span class="url" data-key="url" data-title="URL to the PDF"></span></p>
            <p class="editable"><strong>Rating: </strong><span class="rating" data-key="rating" data-title="Rating (/5)"></span></p>
        </div>
        <div id="paper-notes" style="display: none;">
            <h4>Notes</h4>
            <hr>
            <div id="paper-notes-add" class="text-center">
                <button id="paper-notes-add-btn" class="btn btn-primary">Add notes</button>
            </div>
            <div id="paper-notes-content">
                <textarea id="paper-notes-editor"></textarea>
            </div>
        </div>
        <div id="paper-bibtex" style="display: none;">
            <h4>BibTex entry</h4>
            <hr>
            <pre id="paper-bibtex-content"></pre>
        </div>
        <div id="paper-delete" class="text-center" style="display: none;">
            <button id="paper-delete-btn" class="btn btn-danger">Delete paper</button>
        </div>
    </div>
    <div id="papers-col-right-handle"></div>
    <div id="papers-col-right-open" style="display: none;"><i class="fa fa-caret-left"></i></div>
</div>

<!-- Modals -->
<div class="modal fade" id="modal-spinner" tabindex="-1" role="dialog">
    <div class="content text-center">
        <p><i class="fa fa-refresh fa-4x fa-spin"></i></p>
        <p id="modal-spinner-desc"></p>
    </div>
</div>

<form class="modal fade" id="modal-push" tabindex="-1" role="dialog" method="POST" action="{{ "gitPush" | alias }}">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"><i class="fa fa-cloud-upload"></i> Git commit &amp; push</h4>
            </div>
            <div class="modal-body">
                <p><strong>The following changes will be commited:</strong></p>
                <div id="modal-push-status"></div>
                <div class="form-group">
                    <label for="i_commit">Commit message</label>
                    <textarea class="form-control" rows="4" name="message" id="i_commit"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Commit &amp; push</button>
            </div>
        </div>
    </div>
</form>

<form class="modal fade" id="modal-paper-edit" tabindex="-1" role="dialog" method="POST" action="#" data-base-url="{{ "paperEdit" | alias }}">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"><i class="fa fa-pencil"></i> Edit a paper</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modal-paper-edit-value" id="modal-paper-edit-label"></label>
                    <input type="hidden" name="field" value="" />
                    <input type="hidden" name="file" value="json" />
                    <input class="form-control" rows="4" name="value" id="modal-paper-edit-value" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Edit</button>
            </div>
        </div>
    </div>
</form>

<form class="modal fade" id="modal-paper-add" tabindex="-1" role="dialog" method="POST" action="{{ "paperAdd" | alias }}">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"><i class="fa fa-plus"></i> Add a paper</h4>
            </div>
            <div class="modal-body">
                <p>Add a paper using one of the fields below.</p>
                <div class="form-group">
                    <label for="i_id">ID (arXiv ID or DOI) <small>Must start with <code>arXiv:</code> or <code>doi:</code></small></label>
                    <input type="text" class="form-control" id="i_id" name="id" />
                </div>
                <div class="form-group">
                    <label for="i_bibtex">BibTex entry</label>
                    <textarea class="form-control" rows="9" id="i_bibtex" name="bibtex"></textarea>
                </div>
                <div class="form-group">
                    <label for="i_citation_key">Custom citation key <small>(optional, if not set, will be author name &amp; year)</small></label>
                    <input type="text" class="form-control" rows="9" id="i_citation_key" name="citationKey" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Add</button>
            </div>
        </div>
    </div>
</form>

<form class="modal fade" id="modal-settings" tabindex="-1" role="dialog" method="POST" action="{{ "settings" | alias }}">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"><i class="fa fa-cog"></i> Settings</h4>
            </div>
            <div class="modal-body">
                <h5>Git repository</h5>
                <hr>
                <check if="{{ @user->hasRight('git') }}">
                <true>
                <div class="form-group">
                    <label for="i_git" class="control-label"> Git repo</label>
                    <input type="text" class="form-control" id="i_git" placeholder="Git repo SSH command (e.g. git@github.com:DejaLus/demoLibrary.git)" name="git" value="{{ @user->getGit(); }}">
                </div>
                <div class="form-group">
                    <label class="control-label"> SSH key <sup>*</sup></label>
                    <pre id="ssh-key">{{ @user->getPubkey(); }}</pre>
                </div>
                <p><sup>*</sup> The server needs to be able to read and write on the git repository of your library through SSH. Therefore, you need to grant the server's SSH public key access to your repository. On GitHub, we suggest you use the <a href="https://developer.github.com/guides/managing-deploy-keys/#deploy-keys">Deploy Key</a> feature.</p>
                </true>
                <false>
                <p>Git feature is disabled for your account. Ask your DjLu administrator to enable it if your want to use it.</p>
                </false>
                </check>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</form>
